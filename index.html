<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDPA - Base de Datos de Progreso Automatizado</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- CSS Principal -->
    <?!= HtmlService.createHtmlOutputFromFile('css/main').getContent(); ?>
    
    <!-- CSS Modal -->
    <?!= HtmlService.createHtmlOutputFromFile('css/modal').getContent(); ?>
</head>
<body>
    <!-- Contenedor de Login -->
    <div id="login-container" class="container">
        <div class="login-box">
            <div class="login-header">
                <img src="https://i.imgur.com/Uw8kbQO.png" alt="Logo Larnet" class="login-logo">
                <h1>BDPA</h1>
                <p>Base de Datos de Progreso Automatizado</p>
            </div>
            
            <form id="login-form" onsubmit="return false;">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" name="password" required>
                </div>
                
                <button type="button" class="btn btn-primary btn-block" onclick="iniciarSesion()">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
            </form>
            
            <div id="login-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Iniciando sesión...
            </div>
        </div>
    </div>

    <!-- Contenedor Principal -->
    <div id="main-menu-container" class="hidden">
        <!-- Header -->
        <?!= HtmlService.createHtmlOutputFromFile('partials/header').getContent(); ?>
        
        <!-- Navegación Principal -->
        <nav class="main-nav">
            <div class="nav-container">
                <div class="nav-links">
                    <a href="#" class="nav-link" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="#" class="nav-link" data-section="obras">
                        <i class="fas fa-building"></i> Obras
                    </a>
                    <a href="#" class="nav-link" data-section="avances">
                        <i class="fas fa-tasks"></i> Avances
                    </a>
                    <a href="#" class="nav-link" data-section="inventario">
                        <i class="fas fa-boxes"></i> Inventario
                    </a>
                    <a href="#" class="nav-link" data-section="transferencias">
                        <i class="fas fa-exchange-alt"></i> Transferencias
                    </a>
                    <a href="#" class="nav-link" data-section="planificacion-metas">
                        <i class="fas fa-bullseye"></i> Planificación
                    </a>
                    <a href="#" class="nav-link" data-section="mediciones">
                        <i class="fas fa-ruler"></i> Mediciones
                    </a>
                    <a href="#" class="nav-link" data-section="documentacion">
                        <i class="fas fa-file-alt"></i> Documentación
                    </a>
                    <a href="#" class="nav-link" data-section="cobranzas">
                        <i class="fas fa-chart-line"></i> Progreso
                    </a>
                    <a href="#" class="nav-link" data-section="reportes">
                        <i class="fas fa-chart-bar"></i> Reportes
                    </a>
                    <a href="#" class="nav-link admin-only" data-section="gestion-usuarios">
                        <i class="fas fa-users"></i> Usuarios
                    </a>
                    <a href="#" class="nav-link admin-supervisor-only" data-section="configuracion">
                        <i class="fas fa-cog"></i> Configuración
                    </a>
                </div>
            </div>
        </nav>

        <!-- Dashboard -->
        <div id="dashboard" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <p>Resumen general del sistema</p>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-obras">0</h3>
                        <p>Obras Activas</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="avances-mes">0</h3>
                        <p>Avances este mes</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="materiales-stock">0</h3>
                        <p>Materiales en stock</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="usuarios-activos">0</h3>
                        <p>Usuarios activos</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-content">
                <div class="dashboard-section">
                    <h3>Obras Recientes</h3>
                    <div id="obras-recientes" class="content-list">
                        <!-- Se carga dinámicamente -->
                    </div>
                </div>
                
                <div class="dashboard-section">
                    <h3>Avances Recientes</h3>
                    <div id="avances-recientes" class="content-list">
                        <!-- Se carga dinámicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestión de Obras -->
        <div id="obras" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-building"></i> Gestión de Obras</h2>
                <button class="btn btn-primary" onclick="mostrarFormularioObra()">
                    <i class="fas fa-plus"></i> Nueva Obra
                </button>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <select id="filtro-estado-obra" onchange="filtrarObras()">
                        <option value="">Todos los estados</option>
                        <option value="planificacion">Planificación</option>
                        <option value="en-progreso">En Progreso</option>
                        <option value="completada">Completada</option>
                        <option value="pausada">Pausada</option>
                    </select>
                    
                    <input type="text" id="buscar-obra" placeholder="Buscar obras..." onkeyup="filtrarObras()">
                    
                    <button class="btn btn-secondary" onclick="limpiarFiltrosObras()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Obra</th>
                            <th>Cliente</th>
                            <th>Estado</th>
                            <th>Progreso</th>
                            <th>Fecha Inicio</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="obras-tbody">
                        <!-- Se carga dinámicamente -->
                    </tbody>
                </table>
            </div>
            
            <div id="obras-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando obras...
            </div>
            
            <!-- Formulario de Obra -->
            <div id="formulario-obra" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-building"></i> <span id="titulo-formulario-obra">Nueva Obra</span></h3>
                        <button class="modal-close" onclick="cancelarObra()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-obra" onsubmit="return false;">
                            <input type="hidden" id="obra-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nombre-obra">Nombre de la Obra *</label>
                                    <input type="text" id="nombre-obra" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="cliente-obra">Cliente *</label>
                                    <input type="text" id="cliente-obra" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="direccion-obra">Dirección</label>
                                    <input type="text" id="direccion-obra">
                                </div>
                                
                                <div class="form-group">
                                    <label for="tipo-obra">Tipo de Obra</label>
                                    <select id="tipo-obra">
                                        <option value="edificio">Edificio</option>
                                        <option value="casa">Casa</option>
                                        <option value="oficina">Oficina</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-inicio-obra">Fecha de Inicio</label>
                                    <input type="date" id="fecha-inicio-obra">
                                </div>
                                
                                <div class="form-group">
                                    <label for="fecha-termino-obra">Fecha de Término</label>
                                    <input type="date" id="fecha-termino-obra">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="descripcion-obra">Descripción</label>
                                <textarea id="descripcion-obra" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="cancelarObra()">Cancelar</button>
                        <button class="btn btn-primary" onclick="guardarObra()">Guardar Obra</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registro de Avances -->
        <div id="avances" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-tasks"></i> Registro de Avances</h2>
                <button class="btn btn-primary" onclick="mostrarFormularioAvance()">
                    <i class="fas fa-plus"></i> Nuevo Avance
                </button>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <select id="filtro-obra-avance" onchange="filtrarAvances()">
                        <option value="">Todas las obras</option>
                    </select>
                    
                    <select id="filtro-tipo-avance" onchange="filtrarAvances()">
                        <option value="">Todos los tipos</option>
                        <option value="coaxial-alambrico">Coaxial Alámbrico</option>
                        <option value="coaxial-inalambrico">Coaxial Inalámbrico</option>
                        <option value="fibra-optica">Fibra Óptica</option>
                    </select>
                    
                    <input type="date" id="filtro-fecha-avance" onchange="filtrarAvances()">
                    
                    <button class="btn btn-secondary" onclick="limpiarFiltrosAvances()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Obra</th>
                            <th>Ubicación</th>
                            <th>Tipo</th>
                            <th>Descripción</th>
                            <th>Técnico</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="avances-tbody">
                        <!-- Se carga dinámicamente -->
                    </tbody>
                </table>
            </div>
            
            <div id="avances-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando avances...
            </div>
            
            <!-- Formulario de Avance -->
            <div id="formulario-avance" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-tasks"></i> <span id="titulo-formulario-avance">Nuevo Avance</span></h3>
                        <button class="modal-close" onclick="cancelarAvance()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-avance" onsubmit="return false;">
                            <input type="hidden" id="avance-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="avance-obra">Obra *</label>
                                    <select id="avance-obra" required onchange="cargarEstructuraAvance()">
                                        <option value="">Seleccionar obra...</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="avance-tipo">Tipo de Avance *</label>
                                    <select id="avance-tipo" required>
                                        <option value="">Seleccionar tipo...</option>
                                        <option value="coaxial-alambrico">Coaxial Alámbrico</option>
                                        <option value="coaxial-inalambrico">Coaxial Inalámbrico</option>
                                        <option value="fibra-optica">Fibra Óptica</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="avance-torre">Torre</label>
                                    <select id="avance-torre" onchange="cargarPisosAvance()">
                                        <option value="">Seleccionar torre...</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="avance-piso">Piso</label>
                                    <select id="avance-piso" onchange="cargarDepartamentosAvance()">
                                        <option value="">Seleccionar piso...</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="avance-ubicacion">Ubicación Específica</label>
                                <input type="text" id="avance-ubicacion" placeholder="Ej: Depto 101, Shaft A, etc.">
                            </div>
                            
                            <div class="form-group">
                                <label for="avance-descripcion">Descripción del Trabajo *</label>
                                <textarea id="avance-descripcion" rows="3" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="avance-fecha">Fecha</label>
                                <input type="date" id="avance-fecha">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="cancelarAvance()">Cancelar</button>
                        <button class="btn btn-primary" onclick="guardarAvance()">Guardar Avance</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestión de Inventario -->
        <div id="inventario" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-boxes"></i> Gestión de Inventario</h2>
                <div class="page-actions">
                    <button class="btn btn-primary" onclick="mostrarFormularioMaterial()">
                        <i class="fas fa-plus"></i> Nuevo Material
                    </button>
                    <button class="btn btn-success" onclick="registrarEntrada()">
                        <i class="fas fa-arrow-down"></i> Entrada
                    </button>
                    <button class="btn btn-warning" onclick="registrarSalida()">
                        <i class="fas fa-arrow-up"></i> Salida
                    </button>
                </div>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <select id="filtro-categoria-material" onchange="filtrarMateriales()">
                        <option value="">Todas las categorías</option>
                    </select>
                    
                    <select id="filtro-stock-material" onchange="filtrarMateriales()">
                        <option value="">Todo el stock</option>
                        <option value="disponible">Con stock</option>
                        <option value="agotado">Sin stock</option>
                        <option value="bajo">Stock bajo</option>
                    </select>
                    
                    <input type="text" id="buscar-material" placeholder="Buscar materiales..." onkeyup="filtrarMateriales()">
                    
                    <button class="btn btn-secondary" onclick="limpiarFiltrosMateriales()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Código</th>
                            <th>Categoría</th>
                            <th>Stock Actual</th>
                            <th>Stock Mínimo</th>
                            <th>Unidad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="materiales-tbody">
                        <!-- Se carga dinámicamente -->
                    </tbody>
                </table>
            </div>
            
            <div id="materiales-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando materiales...
            </div>
            
            <!-- Formulario de Material -->
            <div id="formulario-material" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-box"></i> <span id="titulo-formulario-material">Nuevo Material</span></h3>
                        <button class="modal-close" onclick="cancelarMaterial()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-material" onsubmit="return false;">
                            <input type="hidden" id="material-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nombre-material">Nombre del Material *</label>
                                    <input type="text" id="nombre-material" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="codigo-material">Código</label>
                                    <input type="text" id="codigo-material">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="categoria-material">Categoría</label>
                                    <select id="categoria-material">
                                        <option value="cable">Cable</option>
                                        <option value="conector">Conector</option>
                                        <option value="herramienta">Herramienta</option>
                                        <option value="accesorio">Accesorio</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="unidad-material">Unidad</label>
                                    <select id="unidad-material">
                                        <option value="unidad">Unidad</option>
                                        <option value="metro">Metro</option>
                                        <option value="rollo">Rollo</option>
                                        <option value="caja">Caja</option>
                                        <option value="kg">Kilogramo</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stock-inicial-material">Stock Inicial</label>
                                    <input type="number" id="stock-inicial-material" min="0">
                                </div>
                                
                                <div class="form-group">
                                    <label for="stock-minimo-material">Stock Mínimo</label>
                                    <input type="number" id="stock-minimo-material" min="0">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="descripcion-material">Descripción</label>
                                <textarea id="descripcion-material" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="cancelarMaterial()">Cancelar</button>
                        <button class="btn btn-primary" onclick="guardarMaterial()">Guardar Material</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transferencias -->
        <div id="transferencias" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-exchange-alt"></i> Transferencias de Material</h2>
                <button class="btn btn-primary" onclick="mostrarFormularioTransferencia()">
                    <i class="fas fa-plus"></i> Nueva Transferencia
                </button>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <select id="filtro-obra-origen-trans" onchange="filtrarTransferencias()">
                        <option value="">Obra origen</option>
                    </select>
                    
                    <select id="filtro-obra-destino-trans" onchange="filtrarTransferencias()">
                        <option value="">Obra destino</option>
                    </select>
                    
                    <select id="filtro-estado-trans" onchange="filtrarTransferencias()">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="en-transito">En tránsito</option>
                        <option value="completada">Completada</option>
                        <option value="cancelada">Cancelada</option>
                    </select>
                    
                    <input type="date" id="filtro-fecha-desde-trans" onchange="filtrarTransferencias()">
                    <input type="date" id="filtro-fecha-hasta-trans" onchange="filtrarTransferencias()">
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Origen</th>
                            <th>Destino</th>
                            <th>Material</th>
                            <th>Cantidad</th>
                            <th>Responsable</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="transferencias-tbody">
                        <!-- Se carga dinámicamente -->
                    </tbody>
                </table>
            </div>
            
            <div id="transferencias-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando transferencias...
            </div>
            
            <!-- Formulario de Transferencia -->
            <div id="formulario-transferencia" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-exchange-alt"></i> Nueva Transferencia</h3>
                        <button class="modal-close" onclick="cancelarTransferencia()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-transferencia" onsubmit="return false;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="obra-origen">Obra Origen *</label>
                                    <select id="obra-origen" required onchange="cargarMaterialesDisponiblesObraOrigen()">
                                        <option value="">Seleccionar obra origen...</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="obra-destino">Obra Destino *</label>
                                    <select id="obra-destino" required>
                                        <option value="">Seleccionar obra destino...</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="material-transferencia">Material *</label>
                                    <select id="material-transferencia" required>
                                        <option value="">Seleccionar material...</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="cantidad-transferencia">Cantidad *</label>
                                    <input type="number" id="cantidad-transferencia" min="1" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="responsable-transferencia">Responsable *</label>
                                <input type="text" id="responsable-transferencia" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="motivo-transferencia">Motivo</label>
                                <textarea id="motivo-transferencia" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="cancelarTransferencia()">Cancelar</button>
                        <button class="btn btn-primary" onclick="guardarTransferencia()">Guardar Transferencia</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Planificación y Metas -->
        <div id="planificacion-metas" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-bullseye"></i> Planificación y Metas</h2>
            </div>
            
            <div class="form-group">
                <label for="metas-obra">Seleccionar Obra</label>
                <select id="metas-obra" onchange="cargarMetasObra()">
                    <option value="">Seleccione una obra...</option>
                </select>
            </div>
            
            <div id="metas-container" class="hidden">
                <div class="section-header">
                    <h3>Metas de la Obra</h3>
                    <button class="btn btn-primary" onclick="mostrarFormularioMeta()">
                        <i class="fas fa-plus"></i> Nueva Meta
                    </button>
                </div>
                
                <div class="filters-section">
                    <div class="filters-row">
                        <select id="filtro-tipo-meta" onchange="filtrarMetas()">
                            <option value="">Todos los tipos</option>
                            <option value="avance">Avance</option>
                            <option value="tiempo">Tiempo</option>
                            <option value="calidad">Calidad</option>
                        </select>
                        
                        <select id="filtro-estado-meta" onchange="filtrarMetas()">
                            <option value="">Todos los estados</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="en-curso">En curso</option>
                            <option value="completada">Completada</option>
                            <option value="retrasada">Retrasada</option>
                        </select>
                    </div>
                </div>
                
                <div id="metas-lista" class="goals-container">
                    <!-- Se carga dinámicamente -->
                </div>
                
                <div id="metas-loader" class="loader hidden">
                    <i class="fas fa-spinner fa-spin"></i> Cargando metas...
                </div>
            </div>
            
            <!-- Formulario de Meta -->
            <div id="formulario-meta" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-bullseye"></i> <span id="titulo-formulario-meta">Nueva Meta</span></h3>
                        <button class="modal-close" onclick="cancelarMeta()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-meta" onsubmit="return false;">
                            <input type="hidden" id="meta-id">
                            
                            <div class="form-group">
                                <label for="nombre-meta">Nombre de la Meta *</label>
                                <input type="text" id="nombre-meta" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tipo-meta">Tipo</label>
                                    <select id="tipo-meta">
                                        <option value="avance">Avance</option>
                                        <option value="tiempo">Tiempo</option>
                                        <option value="calidad">Calidad</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="categoria-meta">Categoría</label>
                                    <select id="categoria-meta">
                                        <option value="general">General</option>
                                        <option value="coaxial">Coaxial</option>
                                        <option value="fibra">Fibra Óptica</option>
                                        <option value="instalacion">Instalación</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="valor-meta">Valor Objetivo *</label>
                                    <input type="number" id="valor-meta" min="0" step="0.01" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="unidad-meta">Unidad</label>
                                    <select id="unidad-meta">
                                        <option value="porcentaje">Porcentaje (%)</option>
                                        <option value="unidades">Unidades</option>
                                        <option value="metros">Metros</option>
                                        <option value="dias">Días</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-inicio-meta">Fecha de Inicio</label>
                                    <input type="date" id="fecha-inicio-meta">
                                </div>
                                
                                <div class="form-group">
                                    <label for="fecha-termino-meta">Fecha de Término</label>
                                    <input type="date" id="fecha-termino-meta">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="descripcion-meta">Descripción</label>
                                <textarea id="descripcion-meta" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="cancelarMeta()">Cancelar</button>
                        <button class="btn btn-primary" onclick="guardarMeta()">Guardar Meta</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mediciones -->
        <div id="mediciones" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-ruler"></i> Sistema de Mediciones</h2>
                <button class="btn btn-primary" onclick="mostrarModalMediciones()">
                    <i class="fas fa-plus"></i> Nueva Medición
                </button>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <select id="filtro-obra-medicion" onchange="filtrarMediciones()">
                        <option value="">Todas las obras</option>
                    </select>
                    
                    <select id="filtro-tipo-medicion" onchange="filtrarMediciones()">
                        <option value="">Todos los tipos</option>
                        <option value="coaxial">Coaxial</option>
                        <option value="fibra">Fibra Óptica</option>
                    </select>
                    
                    <select id="filtro-estado-medicion" onchange="filtrarMediciones()">
                        <option value="">Todos los estados</option>
                        <option value="ok">OK</option>
                        <option value="falla">Falla</option>
                        <option value="pendiente">Pendiente</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Obra</th>
                            <th>Torre</th>
                            <th>Piso</th>
                            <th>Unidad</th>
                            <th>Tipo Señal</th>
                            <th>Valor</th>
                            <th>Unidad</th>
                            <th>Estado</th>
                            <th>Fecha</th>
                            <th>Técnico</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="mediciones-tbody">
                        <!-- Se carga dinámicamente -->
                    </tbody>
                </table>
            </div>
            
            <div id="mediciones-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando mediciones...
            </div>
        </div>

        <!-- Documentación -->
        <div id="documentacion" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-file-alt"></i> Gestión Documental</h2>
                <button class="btn btn-primary" onclick="mostrarFormularioDocumento()">
                    <i class="fas fa-plus"></i> Subir Documento
                </button>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <select id="filtro-tipo-doc" onchange="filtrarDocumentos()">
                        <option value="">Todos los tipos</option>
                        <option value="plano">Plano</option>
                        <option value="memoria">Memoria Técnica</option>
                        <option value="manual">Manual</option>
                        <option value="certificado">Certificado</option>
                        <option value="informe">Informe</option>
                        <option value="otro">Otro</option>
                    </select>
                    
                    <select id="filtro-obra-doc" onchange="filtrarDocumentos()">
                        <option value="">Todas las obras</option>
                    </select>
                    
                    <input type="text" id="buscar-doc" placeholder="Buscar documentos..." onkeyup="filtrarDocumentos()">
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Documento</th>
                            <th>Tipo</th>
                            <th>Obra</th>
                            <th>Fecha</th>
                            <th>Usuario</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="documentos-tbody">
                        <!-- Se carga dinámicamente -->
                    </tbody>
                </table>
            </div>
            
            <div id="documentos-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando documentos...
            </div>
            
            <!-- Formulario de Documento -->
            <div id="formulario-documento" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-file-alt"></i> Subir Documento</h3>
                        <button class="modal-close" onclick="cancelarDocumento()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-documento" onsubmit="return false;">
                            <div class="form-group">
                                <label for="doc-nombre">Nombre del Documento *</label>
                                <input type="text" id="doc-nombre" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="doc-tipo">Tipo</label>
                                    <select id="doc-tipo">
                                        <option value="plano">Plano</option>
                                        <option value="memoria">Memoria Técnica</option>
                                        <option value="manual">Manual</option>
                                        <option value="certificado">Certificado</option>
                                        <option value="informe">Informe</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="doc-obra">Obra</label>
                                    <select id="doc-obra">
                                        <option value="">General (sin obra específica)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="doc-archivo">Archivo *</label>
                                <input type="file" id="doc-archivo" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.dwg,.dxf" required>
                                <small class="form-text">Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, DWG, DXF (máx. 10MB)</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="doc-descripcion">Descripción</label>
                                <textarea id="doc-descripcion" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="cancelarDocumento()">Cancelar</button>
                        <button class="btn btn-primary" onclick="guardarDocumento()">Subir Documento</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registro de Progreso (Cobranzas) -->
        <div id="cobranzas" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-chart-line"></i> Registro de Progreso para Cobranzas</h2>
                <button class="btn btn-primary" onclick="mostrarModalRegistroProgreso()">
                    <i class="fas fa-plus"></i> Nuevo Registro
                </button>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <select id="filtro-obra-progreso" onchange="filtrarRegistrosProgreso()">
                        <option value="">Todas las obras</option>
                    </select>
                    
                    <select id="filtro-estado-progreso" onchange="filtrarRegistrosProgreso()">
                        <option value="">Todos los estados</option>
                        <option value="borrador">Borrador</option>
                        <option value="enviado">Enviado</option>
                        <option value="aprobado">Aprobado</option>
                    </select>
                    
                    <input type="date" id="filtro-fecha-progreso" onchange="filtrarRegistrosProgreso()">
                </div>
            </div>
            
            <div id="registros-progreso-container" class="progress-cards-container">
                <!-- Se carga dinámicamente -->
            </div>
            
            <div id="progreso-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando registros...
            </div>
        </div>

        <!-- Reportes -->
        <div id="reportes" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-chart-bar"></i> Reportes y Análisis</h2>
            </div>
            
            <div class="reports-grid">
                <div class="report-card">
                    <div class="report-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="report-info">
                        <h3>Reporte de Avances</h3>
                        <p>Progreso detallado por obra y tipo de trabajo</p>
                        <button class="btn btn-primary" onclick="generarReporte('avances')">
                            <i class="fas fa-file-pdf"></i> Generar
                        </button>
                    </div>
                </div>
                
                <div class="report-card">
                    <div class="report-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="report-info">
                        <h3>Reporte de Inventario</h3>
                        <p>Estado actual del inventario y movimientos</p>
                        <button class="btn btn-primary" onclick="generarReporte('inventario')">
                            <i class="fas fa-file-excel"></i> Generar
                        </button>
                    </div>
                </div>
                
                <div class="report-card">
                    <div class="report-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="report-info">
                        <h3>Reporte de Obras</h3>
                        <p>Estado y progreso general de todas las obras</p>
                        <button class="btn btn-primary" onclick="generarReporte('obras')">
                            <i class="fas fa-file-pdf"></i> Generar
                        </button>
                    </div>
                </div>
                
                <div class="report-card">
                    <div class="report-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="report-info">
                        <h3>Reporte de Productividad</h3>
                        <p>Análisis de productividad por técnico y período</p>
                        <button class="btn btn-primary" onclick="generarReporte('productividad')">
                            <i class="fas fa-file-chart"></i> Generar
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="report-filters">
                <h3>Filtros de Reportes</h3>
                <div class="filters-row">
                    <div class="form-group">
                        <label for="reporte-obra">Obra</label>
                        <select id="reporte-obra">
                            <option value="">Todas las obras</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="reporte-fecha-desde">Desde</label>
                        <input type="date" id="reporte-fecha-desde">
                    </div>
                    
                    <div class="form-group">
                        <label for="reporte-fecha-hasta">Hasta</label>
                        <input type="date" id="reporte-fecha-hasta">
                    </div>
                    
                    <div class="form-group">
                        <label for="reporte-formato">Formato</label>
                        <select id="reporte-formato">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-success" onclick="exportarReporte()">
                        <i class="fas fa-download"></i> Exportar
                    </button>
                    
                    <button class="btn btn-info" onclick="enviarReportePorCorreo()">
                        <i class="fas fa-envelope"></i> Enviar por Email
                    </button>
                </div>
            </div>
        </div>

        <!-- Gestión de Usuarios -->
        <div id="gestion-usuarios" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-users"></i> Gestión de Usuarios</h2>
                <button class="btn btn-primary" onclick="mostrarFormularioUsuario()">
                    <i class="fas fa-plus"></i> Nuevo Usuario
                </button>
            </div>
            
            <div class="filters-section">
                <div class="filters-row">
                    <input type="text" id="buscar-usuario" placeholder="Buscar usuarios..." onkeyup="filtrarUsuarios()">
                    
                    <select id="filtro-rol" onchange="filtrarUsuarios()">
                        <option value="">Todos los roles</option>
                        <option value="Admin">Administrador</option>
                        <option value="Supervisor">Supervisor</option>
                        <option value="Técnico">Técnico</option>
                        <option value="Ayudante">Ayudante</option>
                    </select>
                    
                    <select id="filtro-estado" onchange="filtrarUsuarios()">
                        <option value="">Todos los estados</option>
                        <option value="activo">Activo</option>
                        <option value="bloqueado">Bloqueado</option>
                        <option value="inactivo">Inactivo</option>
                    </select>
                    
                    <button class="btn btn-secondary" onclick="limpiarFiltrosUsuarios()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                    
                    <button class="btn btn-success" onclick="exportarUsuarios()">
                        <i class="fas fa-file-excel"></i> Exportar
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Nombre de Usuario</th>
                            <th>Rol</th>
                            <th>Email</th>
                            <th>Estado</th>
                            <th>Último Acceso</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usuarios-tbody">
                        <!-- Se carga dinámicamente -->
                    </tbody>
                </table>
            </div>
            
            <div id="usuarios-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Cargando usuarios...
            </div>
            
            <!-- Formulario de Usuario -->
            <div id="formulario-usuario" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-user"></i> <span id="titulo-formulario-usuario">Nuevo Usuario</span></h3>
                        <button class="modal-close" onclick="cancelarEdicionUsuario()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-usuario" onsubmit="return false;">
                            <input type="hidden" id="usuario-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nombre-usuario">Nombre *</label>
                                    <input type="text" id="nombre-usuario" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="apellido-usuario">Apellido *</label>
                                    <input type="text" id="apellido-usuario" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="username-usuario">Nombre de Usuario *</label>
                                    <input type="text" id="username-usuario" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="rol-usuario">Rol *</label>
                                    <select id="rol-usuario" required>
                                        <option value="Técnico">Técnico</option>
                                        <option value="Ayudante">Ayudante</option>
                                        <option value="Supervisor">Supervisor</option>
                                        <option value="Admin">Administrador</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contrasena-usuario">Contraseña *</label>
                                    <div class="password-input-group">
                                        <input type="password" id="contrasena-usuario" required>
                                        <button type="button" class="btn-toggle-password" onclick="toggleMostrarContrasena('contrasena-usuario')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div id="contrasena-info" class="form-text hidden">
                                        Deje en blanco para mantener la contraseña actual
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="confirmar-contrasena-usuario">Confirmar Contraseña *</label>
                                    <div class="password-input-group">
                                        <input type="password" id="confirmar-contrasena-usuario" required>
                                        <button type="button" class="btn-toggle-password" onclick="toggleMostrarContrasena('confirmar-contrasena-usuario')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="email-usuario">Email</label>
                                    <input type="email" id="email-usuario">
                                </div>
                                
                                <div class="form-group">
                                    <label for="telefono-usuario">Teléfono</label>
                                    <input type="tel" id="telefono-usuario">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="activo-usuario" checked>
                                        Usuario activo
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="requiere-cambio-contrasena" checked>
                                        Requiere cambio de contraseña
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-info" onclick="mostrarGenerarContrasena()">
                                    <i class="fas fa-random"></i> Generar Contraseña
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="cancelarEdicionUsuario()">Cancelar</button>
                        <button class="btn btn-primary" onclick="guardarUsuario()">Guardar Usuario</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuración -->
        <div id="configuracion" class="container hidden">
            <div class="page-header">
                <h2><i class="fas fa-cog"></i> Configuración del Sistema</h2>
            </div>
            
            <div class="config-tabs">
                <div class="tab-nav">
                    <a href="#" class="nav-link active" onclick="mostrarTabConfig('general')">
                        <i class="fas fa-cogs"></i> General
                    </a>
                    <a href="#" class="nav-link" onclick="mostrarTabConfig('avances')">
                        <i class="fas fa-tasks"></i> Avances
                    </a>
                    <a href="#" class="nav-link" onclick="mostrarTabConfig('notificaciones')">
                        <i class="fas fa-bell"></i> Notificaciones
                    </a>
                    <a href="#" class="nav-link" onclick="mostrarTabConfig('backup')">
                        <i class="fas fa-database"></i> Backup
                    </a>
                </div>
                
                <!-- Configuración General -->
                <div id="config-general" class="tab-content">
                    <h3>Configuración General</h3>
                    <form onsubmit="return false;">
                        <div class="form-group">
                            <label for="nombre-empresa">Nombre de la Empresa</label>
                            <input type="text" id="nombre-empresa" value="Larnet Telecomunicaciones">
                        </div>
                        
                        <div class="form-group">
                            <label for="email-notificaciones">Email para Notificaciones</label>
                            <input type="email" id="email-notificaciones">
                        </div>
                        
                        <div class="form-group">
                            <label for="items-por-pagina">Items por Página</label>
                            <input type="number" id="items-por-pagina" min="10" max="100" value="20">
                        </div>
                        
                        <button class="btn btn-primary" onclick="guardarConfiguracionGeneral()">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </form>
                </div>
                
                <!-- Configuración de Avances -->
                <div id="config-avances" class="tab-content hidden">
                    <h3>Configuración de Avances</h3>
                    <form onsubmit="return false;">
                        <div class="form-group">
                            <label for="permitir-edicion-avances">Permitir Edición de Avances</label>
                            <select id="permitir-edicion-avances">
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                                <option value="solo-admin">Solo Administradores</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="dias-edicion-avances">Días Permitidos para Editar</label>
                            <input type="number" id="dias-edicion-avances" min="0" max="30" value="7">
                        </div>
                        
                        <button class="btn btn-primary" onclick="guardarConfiguracionAvances()">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </form>
                </div>
                
                <!-- Configuración de Notificaciones -->
                <div id="config-notificaciones" class="tab-content hidden">
                    <h3>Configuración de Notificaciones</h3>
                    <form onsubmit="return false;">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="notificar-avances-completados" checked>
                                Notificar cuando se completen avances
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="notificar-stock-bajo" checked>
                                Notificar cuando el stock esté bajo
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="notificar-obras-retrasadas" checked>
                                Notificar obras retrasadas
                            </label>
                        </div>
                        
                        <button class="btn btn-primary" onclick="guardarConfiguracionNotificaciones()">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </form>
                </div>
                
                <!-- Configuración de Backup -->
                <div id="config-backup" class="tab-content hidden">
                    <h3>Configuración de Backup</h3>
                    <form onsubmit="return false;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="frecuencia-backup">Frecuencia de Backup</label>
                                <select id="frecuencia-backup">
                                    <option value="diario">Diario</option>
                                    <option value="semanal">Semanal</option>
                                    <option value="mensual">Mensual</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="hora-backup">Hora de Backup</label>
                                <input type="time" id="hora-backup" value="02:00">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="guardarConfiguracionBackup()">
                                <i class="fas fa-save"></i> Guardar Configuración
                            </button>
                            
                            <button class="btn btn-warning" onclick="realizarBackupManual()">
                                <i class="fas fa-download"></i> Backup Manual
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div id="config-loader" class="loader hidden">
                <i class="fas fa-spinner fa-spin"></i> Guardando configuración...
            </div>
        </div>

        <!-- Footer -->
        <?!= HtmlService.createHtmlOutputFromFile('partials/footer').getContent(); ?>
    </div>

    <!-- Modal de Maquetación -->
    <?!= HtmlService.createHtmlOutputFromFile('partials/modal-maquetacion').getContent(); ?>

    <!-- Modal de Mediciones -->
    <div id="modal-mediciones" class="modal-overlay hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3><i class="fas fa-ruler"></i> Sistema de Mediciones</h3>
                <button class="modal-close" onclick="cerrarModalMediciones()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="medicion-setup">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="medicion-obra">Obra</label>
                            <select id="medicion-obra" onchange="cargarEstructuraMedicion()">
                                <option value="">Seleccionar obra...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="medicion-torre">Torre</label>
                            <select id="medicion-torre">
                                <option value="">Seleccionar torre...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="medicion-tipo-senal">Tipo de Señal</label>
                            <select id="medicion-tipo-senal" onchange="cambiarTipoMedicion()">
                                <option value="">Seleccionar tipo...</option>
                                <option value="COAXIAL_ALAMBRICO">Coaxial Alámbrico</option>
                                <option value="COAXIAL_INALAMBRICO">Coaxial Inalámbrico</option>
                                <option value="FO">Fibra Óptica</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="contenedor-tabla-mediciones" class="hidden">
                    <h4 id="tipo-senal-titulo">Mediciones</h4>
                    
                    <!-- Tabla para mediciones coaxiales -->
                    <div id="tabla-coaxial" class="mediciones-table hidden">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th rowspan="2">Piso</th>
                                    <th rowspan="2">Depto</th>
                                    <th colspan="4">Potencia (dBμV)</th>
                                    <th colspan="4">dB respecto base trazado</th>
                                </tr>
                                <tr>
                                    <th>53 MHz</th>
                                    <th>400 MHz</th>
                                    <th>800 MHz</th>
                                    <th>1220 MHz</th>
                                    <th>53 MHz</th>
                                    <th>400 MHz</th>
                                    <th>800 MHz</th>
                                    <th>1220 MHz</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-mediciones-coaxial">
                                <!-- Se carga dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Tabla para mediciones de fibra óptica -->
                    <div id="tabla-fo" class="mediciones-table hidden">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Piso</th>
                                    <th>Depto</th>
                                    <th>Potencia TX (dBm)</th>
                                    <th>Potencia RX (dBm)</th>
                                    <th>Atenuación (dB)</th>
                                    <th>Estado</th>
                                    <th>Observaciones</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-mediciones-fo">
                                <!-- Se carga dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="acciones-mediciones" class="hidden">
                    <div class="form-actions">
                        <button class="btn btn-info" onclick="mostrarValoresReferencia()">
                            <i class="fas fa-info-circle"></i> Valores de Referencia
                        </button>
                        
                        <button class="btn btn-warning" onclick="validarMediciones()">
                            <i class="fas fa-check"></i> Validar
                        </button>
                        
                        <button class="btn btn-success" onclick="exportarHojaMediciones()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                        
                        <button class="btn btn-secondary" onclick="limpiarMediciones()">
                            <i class="fas fa-eraser"></i> Limpiar
                        </button>
                        
                        <button class="btn btn-primary" onclick="guardarMediciones()">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Valores de Referencia -->
    <div id="modal-valores-referencia" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> Valores de Referencia</h3>
                <button class="modal-close" onclick="cerrarModalValoresReferencia()">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Coaxial (dBμV)</h4>
                <table class="reference-table">
                    <thead>
                        <tr>
                            <th>Frecuencia</th>
                            <th>Rango Aceptable</th>
                            <th>Tolerancia dB</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>53 MHz</td>
                            <td>45 - 65 dBμV</td>
                            <td>±3 dB</td>
                        </tr>
                        <tr>
                            <td>400 MHz</td>
                            <td>45 - 65 dBμV</td>
                            <td>±3 dB</td>
                        </tr>
                        <tr>
                            <td>800 MHz</td>
                            <td>45 - 65 dBμV</td>
                            <td>±3 dB</td>
                        </tr>
                        <tr>
                            <td>1220 MHz</td>
                            <td>45 - 65 dBμV</td>
                            <td>±3 dB</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>Fibra Óptica (dBm)</h4>
                <table class="reference-table">
                    <thead>
                        <tr>
                            <th>Parámetro</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Potencia mínima</td>
                            <td>-30 dBm</td>
                        </tr>
                        <tr>
                            <td>Potencia máxima</td>
                            <td>-8 dBm</td>
                        </tr>
                        <tr>
                            <td>Atenuación máxima</td>
                            <td>0.5 dB</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="cerrarModalValoresReferencia()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Registro de Progreso -->
    <div id="modal-registro-progreso" class="modal-overlay hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3><i class="fas fa-chart-line"></i> Registro de Progreso para Cobranza</h3>
                <button class="modal-close" onclick="cerrarModalRegistroProgreso()">&times;</button>
            </div>
            <div class="modal-body">
                <form onsubmit="return false;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="progreso-obra">Obra</label>
                            <select id="progreso-obra" onchange="cargarProgresoObra()">
                                <option value="">Seleccione una obra...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="periodo-desde">Período Desde</label>
                            <input type="date" id="periodo-desde">
                        </div>
                        
                        <div class="form-group">
                            <label for="periodo-hasta">Período Hasta</label>
                            <input type="date" id="periodo-hasta">
                        </div>
                    </div>
                    
                    <div id="info-obra-progreso" class="obra-info-card hidden">
                        <h4>Información de la Obra</h4>
                        <div class="info-grid">
                            <div><strong>Empresa:</strong> <span id="progreso-empresa"></span></div>
                            <div><strong>Fecha Inicio:</strong> <span id="progreso-fecha-inicio"></span></div>
                            <div><strong>Tipo:</strong> <span id="progreso-tipo-obra"></span></div>
                        </div>
                    </div>
                    
                    <div id="progreso-detallado" class="hidden">
                        <h4>Progreso por Tipo de Señal</h4>
                        
                        <div class="progress-section">
                            <h5><i class="fas fa-cable"></i> Coaxial Alámbrico</h5>
                            <div class="progress-display">
                                <div class="progress-bar-container">
                                    <div id="bar-alambrico" class="progress-bar" style="width: 0%"></div>
                                </div>
                                <span id="porcentaje-alambrico" class="progress-percentage">0%</span>
                            </div>
                            <div class="progress-stats">
                                <span>Completadas: <strong id="alambrico-completadas">0</strong></span>
                                <span>Total: <strong id="alambrico-total">0</strong></span>
                                <span>Último avance: <strong id="alambrico-ultimo">-</strong></span>
                            </div>
                            <div class="trabajos-realizados">
                                <h6>Trabajos Realizados:</h6>
                                <ul id="alambrico-trabajos"></ul>
                            </div>
                        </div>
                        
                        <div class="progress-section">
                            <h5><i class="fas fa-wifi"></i> Coaxial Inalámbrico</h5>
                            <div class="progress-display">
                                <div class="progress-bar-container">
                                    <div id="bar-inalambrico" class="progress-bar" style="width: 0%"></div>
                                </div>
                                <span id="porcentaje-inalambrico" class="progress-percentage">0%</span>
                            </div>
                            <div class="progress-stats">
                                <span>Completadas: <strong id="inalambrico-completadas">0</strong></span>
                                <span>Total: <strong id="inalambrico-total">0</strong></span>
                                <span>Último avance: <strong id="inalambrico-ultimo">-</strong></span>
                            </div>
                            <div class="trabajos-realizados">
                                <h6>Trabajos Realizados:</h6>
                                <ul id="inalambrico-trabajos"></ul>
                            </div>
                        </div>
                        
                        <div class="progress-section">
                            <h5><i class="fas fa-network-wired"></i> Fibra Óptica</h5>
                            <div class="progress-display">
                                <div class="progress-bar-container">
                                    <div id="bar-fo" class="progress-bar" style="width: 0%"></div>
                                </div>
                                <span id="porcentaje-fo" class="progress-percentage">0%</span>
                            </div>
                            <div class="progress-stats">
                                <span>Completadas: <strong id="fo-completadas">0</strong></span>
                                <span>Total: <strong id="fo-total">0</strong></span>
                                <span>Último avance: <strong id="fo-ultimo">-</strong></span>
                            </div>
                            <div class="trabajos-realizados">
                                <h6>Trabajos Realizados:</h6>
                                <ul id="fo-trabajos"></ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="descripcion-progreso">Descripción del Progreso</label>
                        <textarea id="descripcion-progreso" rows="4" placeholder="Describa el progreso realizado en este período..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="observaciones-progreso">Observaciones</label>
                        <textarea id="observaciones-progreso" rows="3" placeholder="Observaciones adicionales..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="incluir-fotos-progreso">
                            Incluir fotografías en el reporte
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalRegistroProgreso()">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarRegistroProgreso()">Guardar Registro</button>
            </div>
        </div>
    </div>

    <!-- Scripts Core (NUEVOS - RESUELVEN PROBLEMAS CRÍTICOS) -->
    <?!= HtmlService.createHtmlOutputFromFile('js/core-notifications').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/core-navigation').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/core-utils').getContent(); ?>

    <!-- Scripts Principales -->
    <?!= HtmlService.createHtmlOutputFromFile('js/main').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/api').getContent(); ?>

    <!-- Scripts de Módulos -->
    <?!= HtmlService.createHtmlOutputFromFile('js/usuarios').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/transferencias').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/planificacion').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/mediciones').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/documentacion').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/configuracion').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('js/cobranzas').getContent(); ?>

    <!-- Scripts de Módulos Faltantes (Stubs) -->
    <script>
        // ============================================================================
        // STUBS PARA MÓDULOS FALTANTES - EVITAN ERRORES JAVASCRIPT
        // ============================================================================
        
        // Funciones de Obras (Módulo faltante)
        function mostrarFormularioObra() {
            mostrarInfo('Módulo de obras en desarrollo');
        }
        
        function cancelarObra() {
            document.getElementById('formulario-obra').classList.add('hidden');
        }
        
        function guardarObra() {
            mostrarInfo('Función de guardar obra en desarrollo');
        }
        
        function editarObra(id) {
            mostrarInfo('Función de editar obra en desarrollo');
        }
        
        function eliminarObra(id) {
            mostrarInfo('Función de eliminar obra en desarrollo');
        }
        
        function filtrarObras() {
            mostrarInfo('Función de filtrar obras en desarrollo');
        }
        
        function limpiarFiltrosObras() {
            mostrarInfo('Función de limpiar filtros en desarrollo');
        }
        
        function cargarObras() {
            mostrarInfo('Función de cargar obras en desarrollo');
        }
        
        // Funciones de Avances (Módulo faltante)
        function mostrarFormularioAvance() {
            mostrarInfo('Módulo de avances en desarrollo');
        }
        
        function cancelarAvance() {
            document.getElementById('formulario-avance').classList.add('hidden');
        }
        
        function guardarAvance() {
            mostrarInfo('Función de guardar avance en desarrollo');
        }
        
        function editarAvance(id) {
            mostrarInfo('Función de editar avance en desarrollo');
        }
        
        function eliminarAvance(id) {
            mostrarInfo('Función de eliminar avance en desarrollo');
        }
        
        function filtrarAvances() {
            mostrarInfo('Función de filtrar avances en desarrollo');
        }
        
        function limpiarFiltrosAvances() {
            mostrarInfo('Función de limpiar filtros en desarrollo');
        }
        
        function cargarAvances() {
            mostrarInfo('Función de cargar avances en desarrollo');
        }
        
        function cargarEstructuraAvance() {
            mostrarInfo('Función de cargar estructura en desarrollo');
        }
        
        function cargarPisosAvance() {
            mostrarInfo('Función de cargar pisos en desarrollo');
        }
        
        function cargarDepartamentosAvance() {
            mostrarInfo('Función de cargar departamentos en desarrollo');
        }
        
        // Funciones de Inventario (Módulo faltante)
        function mostrarFormularioMaterial() {
            mostrarInfo('Módulo de inventario en desarrollo');
        }
        
        function cancelarMaterial() {
            document.getElementById('formulario-material').classList.add('hidden');
        }
        
        function guardarMaterial() {
            mostrarInfo('Función de guardar material en desarrollo');
        }
        
        function editarMaterial(id) {
            mostrarInfo('Función de editar material en desarrollo');
        }
        
        function eliminarMaterial(id) {
            mostrarInfo('Función de eliminar material en desarrollo');
        }
        
        function registrarEntrada() {
            mostrarInfo('Función de registrar entrada en desarrollo');
        }
        
        function registrarSalida() {
            mostrarInfo('Función de registrar salida en desarrollo');
        }
        
        function filtrarMateriales() {
            mostrarInfo('Función de filtrar materiales en desarrollo');
        }
        
        function limpiarFiltrosMateriales() {
            mostrarInfo('Función de limpiar filtros en desarrollo');
        }
        
        function cargarMateriales() {
            mostrarInfo('Función de cargar materiales en desarrollo');
        }
        
        // Funciones de Reportes (Módulo faltante)
        function generarReporte(tipo) {
            mostrarInfo(`Generación de reporte ${tipo} en desarrollo`);
        }
        
        function exportarReporte(tipo, formato) {
            mostrarInfo(`Exportación de reporte en desarrollo`);
        }
        
        function enviarReportePorCorreo() {
            mostrarInfo('Envío de reporte por correo en desarrollo');
        }
        
        // Funciones de Dashboard (Módulo faltante)
        function cargarDashboard() {
            mostrarInfo('Dashboard en desarrollo');
            // Simular datos básicos
            document.getElementById('total-obras').textContent = '0';
            document.getElementById('avances-mes').textContent = '0';
            document.getElementById('materiales-stock').textContent = '0';
            document.getElementById('usuarios-activos').textContent = '0';
        }
        
        // Función de login (básica)
        function iniciarSesion() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                mostrarError('Ingrese usuario y contraseña');
                return;
            }
            
            // Simulación básica de login
            if (username === 'admin' && password === 'admin123') {
                // Simular usuario
                window.usuarioActual = {
                    id: '1',
                    nombre: 'Administrador',
                    apellido: 'Sistema',
                    usuario: 'admin',
                    rol: 'Admin',
                    email: 'admin@bdpa.larnet.cl'
                };
                
                // Actualizar header
                document.getElementById('current-user').textContent = 'Administrador Sistema';
                document.getElementById('current-role').textContent = 'Administrador';
                
                mostrarExito('Sesión iniciada correctamente');
                mostrarSeccion('dashboard');
            } else {
                mostrarError('Usuario o contraseña incorrectos');
            }
        }
        
        console.log('[STUBS] Funciones stub cargadas para evitar errores JavaScript');
    </script>
</body>
</html>